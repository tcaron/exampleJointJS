<!DOCTYPE>
<html lang="fr">
<html>
    <head>
    <meta charset="utf-8">
     <title>Example jointJS</title>
     <link rel="stylesheet" href="css/shape.css">
     <script src="js/jquery-3.2.0.min.js"></script>    
     <script src="js/index.js"></script>
      <script src="js/backbone.js"></script>
     <script src="js/joint.min.js"></script>
     <script src="js/devs.js"></script>
    </head>

    <body>
        <h1>M12</h1>
       <div id="m12"></div>
  <script type="text/javascript">

    var graph = new joint.dia.Graph;

    var paper = new joint.dia.Paper({
        el: $('#m12'),
        width: 1250,
        height: 700,
        model: graph,
        gridSize: 1
    });

 var m12 = new joint.shapes.devs.Model({
    position: { x: 50, y: 50 },
    size: { width: 700, height: 400 },
    inPorts: ['in'],
    outPorts: ['out'],
    ports: {
        groups: {
            'in': {
                attrs: {
                    '.port-body': {
                        fill: '#16A085'
                    }
                }
            },
            'out': {
                attrs: {
                    '.port-body': {
                        fill: '#E74C3C'
                    }
                }
            }
        }
    },
    attrs: {
        '.label': { text: 'M12', 'ref-x': .5, 'ref-y': .2 },
        rect: { fill: '#C0D3D1' }
    }
});

var m1 = new joint.shapes.devs.Model({
    position: { x: 150, y: 200 },
    size: { width: 100, height: 100 },
    inPorts: ['x1','x2'],
    outPorts: ['out'],
    ports: {
        groups: {
            'in': {
                attrs: {
                    '.port-body': {
                        fill: '#16A085'
                    }
                }
            },
            'out': {
                attrs: {
                    '.port-body': {
                        fill: '#E74C3C'
                    }
                }
            }
        }
    },
    attrs: {
        '.label': { text: 'm1:M1', 'ref-x': .5, 'ref-y': .2 },
        rect: { fill: '#73EBDB' }
    }
});

var m2 = new joint.shapes.devs.Model({
    position: { x: 550, y: 200 },
    size: { width: 100, height: 100 },
    inPorts: ['in'],
    outPorts: ['out1','out2'],
    ports: {
        groups: {
            'in': {
                attrs: {
                    '.port-body': {
                        fill: '#16A085'
                    }
                }
            },
            'out': {
                attrs: {
                    '.port-body': {
                        fill: '#E74C3C'
                    }
                }
            }
        }
    },
    attrs: {
        '.label': { text: 'm2:M2', 'ref-x': .5, 'ref-y': .2 },
        rect: { fill: '#73EBDB' }
    }
});

 m12.embed(m1);
 m12.embed(m2);
 graph.addCell([m12,m1,m2]);


    // links 
    var l1 = new joint.shapes.devs.Link({
        source: { id: m12.id, port: 'in'}, target: {id: m1.id,port: 'x1' },
         attrs: {  '.connection': { stroke: 'blue' },
    '.marker-source': { fill: 'red', d: 'M 10 0 L 0 5 L 10 10 z' },
    '.marker-target': { fill: 'yellow', d: 'M 10 0 L 0 5 L 10 10 z' }},
    });
     var l2 = new joint.shapes.devs.Link({
        source: { id: m1.id,port: 'in'}, target: {id: m2.id, port: 'out' },
       attrs: {  '.connection': { stroke: 'blue' },
    '.marker-source': { fill: 'red', d: 'M 10 0 L 0 5 L 10 10 z' },
    '.marker-target': { fill: 'yellow', d: 'M 10 0 L 0 5 L 10 10 z' }},
    });

     var l3 = new joint.shapes.devs.Link({
        source: { id: m1.id, port: 'x2' },  target: { id: m2.id,  port: 'out2'},
         attrs: {  '.connection': { stroke: 'blue' },
    '.marker-source': { fill: 'red', d: 'M 10 0 L 0 5 L 10 10 z' },
    '.marker-target': { fill: 'yellow', d: 'M 10 0 L 0 5 L 10 10 z' }},
   });

     var l4 = new joint.shapes.devs.Link({ source: { id: m12.id,  port: 'out' },
     target: { id: m2.id, port: 'out1' },
      attrs: {  '.connection': { stroke: 'blue' },
    '.marker-source': { fill: 'red', d: 'M 10 0 L 0 5 L 10 10 z' },
    '.marker-target': { fill: 'yellow', d: 'M 10 0 L 0 5 L 10 10 z' }},
    });
    
    graph.addCell([l1,l2,l3,l4]);
   
// m1 and m2 can't moove beyond m12
 graph.on('change:position', function(cell) {

    var parentId = cell.get('parent');
    if (!parentId) return;

    var parent = graph.getCell(parentId);
    var parentBbox = parent.getBBox();
    var cellBbox = cell.getBBox();

    if (parentBbox.containsPoint(cellBbox.origin()) &&
        parentBbox.containsPoint(cellBbox.topRight()) &&
        parentBbox.containsPoint(cellBbox.corner()) &&
        parentBbox.containsPoint(cellBbox.bottomLeft())) {

        // All the four corners of the child are inside
        // the parent area.
        return;
    }

    // Revert the child position.
    cell.set('position', cell.previous('position'));
    });

  </script>

 </body>
</html>